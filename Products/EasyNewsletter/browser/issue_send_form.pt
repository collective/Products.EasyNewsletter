<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="EasyNewsletter">
<body>

<div metal:fill-slot="main">

  <h1 i18n:translate="easynewsletter_sendnewsletter_label"
      class="documentFirstHeading">
    Send Issue
  </h1>

  <a class="link-parent"
     tal:attributes="href context/aq_parent/absolute_url"
     i18n:translate="easynewsletter_backtonewsletter_label">
  Back to newsletter
  </a>  

  <br/>
  <form tal:attributes="action string:${context/absolute_url}/send-issue"
        tal:define="wtool context/portal_workflow;
                    sent python:wtool.getInfoFor(context, 'review_state') == 'sent'"
        method="post">

    <label for="sender name" 
           i18n:translate="EasyNewsletter_label_senderName"> 
           Sender name
    </label> 

    <div i18n:translate="EasyNewsletter_help_senderNameForm" 
         class="formHelp">
         Sender name of the newsletter e-mail.
         If you let this field empty, the default sender name will be used.
    </div>

    <input type="text"
           name="sender_name"
           tal:attributes="value python:context.REQUEST.get('sender_name', context.aq_parent.getSenderName())" /> 
           
    <br/><br/>           

    <label for="sender_email" 
           i18n:translate="EasyNewsletter_label_senderEmail"> 
           Sender e-mail
    </label> 

    <div i18n:translate="EasyNewsletter_help_senderEmailForm" 
         class="formHelp"> 
         Sender address of the newsletter e-mail. 
         If you let this field empty, the default sender e-mail address will be used.
    </div>

    <input type="text"
           name="sender_email"
           tal:attributes="value python:context.REQUEST.get('sender_email', context.aq_parent.getSenderEmail())" /> 
           
    <br/><br/>           

    <label for="subject" 
           i18n:translate="EasyNewsletter_label_subject"> 
           Subject
    </label> 

    <div i18n:translate="EasyNewsletter_help_subject" 
         class="formHelp"> 
         Subject of the newsletter e-mail.
         If you let this field empty, the title of the newsletter will be used. 
    </div>

    <input type="text"
           name="subject"
           tal:attributes="value python:context.REQUEST.get('subject', context.Title())" /> 
           
    <br/><br/>           

    <!-- <label for="receivers" 
           i18n:translate="EasyNewsletter_label_receivers"> 
           Receivers
    </label> 

    <div i18n:translate="EasyNewsletter_help_receivers" 
         class="formHelp"> 
         Selected subscribers will be used as receivers of the newsletter.
    </div>

    <select multiple="multiple"
            name="receivers"
            size="5"
            tal:define="all_subscribers context/getAllSubscribers;
                        receivers context/getReceivers">
                        
      <option tal:repeat="subscriber all_subscribers"
              tal:content="subscriber"
              tal:attributes="value subscriber;
                              selected python:test(subscriber in receivers, 'selected', '')">
        E-mail address receiver
      </option>
    </select>
    <br/><br/> -->

    <label for="test_receiver" 
           i18n:translate="EasyNewsletter_label_testreceiver"> 
           Test e-mail
    </label> 

    <div i18n:translate="EasyNewsletter_help_testreceiverForm" 
         class="formHelp"> 
         Test e-mail. If you let this field empty, the default test e-mail address will be used. 
    </div>

    <input type="text"
           name="test_receiver"
           tal:attributes="value python:context.REQUEST.get('test_receiver', context.aq_parent.getTestEmail())" /> 
           
    <br/><br/>           
    
    <div tal:condition="sent"
          i18n:translate="easynewsletter_newslettersent_label">
      The newsletter was already sent.
    </div>
    <br/>    
    <input tal:condition="not:sent"
           type="submit" 
           name="send"
           value="Send Newsletter"
           i18n:attributes="value easynewsletter_send_button;"/>
           
    <input type="submit"
           name="test"
           value="Test Newsletter"
           i18n:attributes="value easynewsletter_test_button;"/>
  </form>
    
</div>

</body>
</html>
